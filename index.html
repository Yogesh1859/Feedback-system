<!DOCTYPE html>
<html>
<head>
    <title>Feedback System with Form Codes</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f9; text-align: center; }
        .container { background: white; padding: 20px; margin: 30px auto; width: 420px; border-radius: 10px;
                     box-shadow: 0px 4px 8px rgba(0,0,0,0.2); }
        input, textarea, button { width: 90%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ccc; }
        button { background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
        #feedbackList { text-align: left; margin-top: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 15px; }
        th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
    </style>
</head>
<body>

    <!-- Login -->
    <div class="container" id="loginDiv">
        <h2>Login</h2>
        <input type="text" id="loginUser" placeholder="Username" required><br>
        <input type="password" id="loginPass" placeholder="Password" required><br>
        <select id="loginRole">
            <option value="user">User</option>
            <option value="admin">Admin</option>
        </select><br>
        <button onclick="login()">Login</button>
        <p>Or <a href="#" onclick="showRegister()">Register</a></p>
    </div>

    <!-- Register -->
    <div class="container" id="registerDiv" style="display:none;">
        <h2>Register</h2>
        <input type="text" id="regUser" placeholder="Username" required><br>
        <input type="password" id="regPass" placeholder="Password" required><br>
        <select id="regRole">
            <option value="user">User</option>
            <option value="admin">Admin</option>
        </select><br>
        <button onclick="register()">Register</button>
        <p><a href="#" onclick="showLogin()">Back to Login</a></p>
    </div>

    <!-- User -->
    <div class="container" id="userDiv" style="display:none;">
        <h2>User Feedback</h2>
        <input type="text" id="formCodeInput" placeholder="Enter Form Code" required><br>
        <button onclick="openForm()">Open Form</button>
        <div id="feedbackForm" style="display:none;">
            <h3 id="formTitle"></h3>
            <input type="text" id="name" placeholder="Your Name" required><br>
            <input type="email" id="email" placeholder="Your Email" required><br>
            <input type="number" id="rating" placeholder="Rating (1-5)" min="1" max="5" required><br>
            <textarea id="comments" placeholder="Your Comments" required></textarea><br>
            <button onclick="saveFeedback()">Submit Feedback</button><br>
        </div>
        <button onclick="logout()">Logout</button>
    </div>

    <!-- Admin -->
    <div class="container" id="adminDiv" style="display:none;">
        <h2>Admin Panel</h2>
        <h3>Create New Form</h3>
        <input type="text" id="formTitleInput" placeholder="Form Title" required><br>
        <button onclick="createForm()">Create Form</button>
        <div id="myForms"></div>
        <button onclick="logout()">Logout</button>
    </div>

<script>
    // ----------- LocalStorage Setup -----------
    if (!localStorage.getItem("users")) localStorage.setItem("users", JSON.stringify([]));
    if (!localStorage.getItem("feedbacks")) localStorage.setItem("feedbacks", JSON.stringify([]));
    if (!localStorage.getItem("forms")) localStorage.setItem("forms", JSON.stringify([]));

    function showRegister() {
        document.getElementById("loginDiv").style.display = "none";
        document.getElementById("registerDiv").style.display = "block";
    }
    function showLogin() {
        document.getElementById("registerDiv").style.display = "none";
        document.getElementById("loginDiv").style.display = "block";
    }

    // ----------- Registration -----------
    function register() {
        let username = document.getElementById("regUser").value;
        let password = document.getElementById("regPass").value;
        let role = document.getElementById("regRole").value;

        let users = JSON.parse(localStorage.getItem("users"));

        if (users.find(u => u.username === username && u.role === role)) {
            alert("User already exists!");
            return;
        }

        users.push({ username, password, role });
        localStorage.setItem("users", JSON.stringify(users));
        alert("Registration successful! Please login.");
        showLogin();
    }

    // ----------- Login -----------
    function login() {
        let username = document.getElementById("loginUser").value;
        let password = document.getElementById("loginPass").value;
        let role = document.getElementById("loginRole").value;

        let users = JSON.parse(localStorage.getItem("users"));
        let user = users.find(u => u.username === username && u.password === password && u.role === role);

        if (!user) {
            alert("Invalid credentials!");
            return;
        }

        localStorage.setItem("currentUser", JSON.stringify(user));

        if (role === "user") {
            document.getElementById("loginDiv").style.display = "none";
            document.getElementById("userDiv").style.display = "block";
        } else {
            document.getElementById("loginDiv").style.display = "none";
            document.getElementById("adminDiv").style.display = "block";
            loadForms();
        }
    }

    // ----------- Logout -----------
    function logout() {
        localStorage.removeItem("currentUser");
        document.getElementById("userDiv").style.display = "none";
        document.getElementById("adminDiv").style.display = "none";
        document.getElementById("loginDiv").style.display = "block";
    }

    // ----------- Create Form (Admin) -----------
    function createForm() {
        let title = document.getElementById("formTitleInput").value;
        if (!title) {
            alert("Enter form title!");
            return;
        }
        let currentUser = JSON.parse(localStorage.getItem("currentUser"));
        let forms = JSON.parse(localStorage.getItem("forms"));

        let formCode = "FORM" + Math.floor(Math.random() * 10000);
        forms.push({ admin: currentUser.username, title, code: formCode });
        localStorage.setItem("forms", JSON.stringify(forms));

        alert("Form created! Share this code with users: " + formCode);
        document.getElementById("formTitleInput").value = "";
        loadForms();
    }

    // ----------- Load Forms (Admin) -----------
    function loadForms() {
        let currentUser = JSON.parse(localStorage.getItem("currentUser"));
        let forms = JSON.parse(localStorage.getItem("forms"));
        let feedbacks = JSON.parse(localStorage.getItem("feedbacks"));

        let myForms = forms.filter(f => f.admin === currentUser.username);

        let html = "<h3>My Forms</h3>";
        myForms.forEach(f => {
            let formFeedbacks = feedbacks.filter(x => x.formCode === f.code);
            html += `<div style='border:1px solid #ccc; margin:10px; padding:10px;'>
                        <b>${f.title}</b> (Code: ${f.code})
                        <table><tr><th>Name</th><th>Email</th><th>Rating</th><th>Comments</th></tr>`;
            formFeedbacks.forEach(x => {
                html += `<tr><td>${x.name}</td><td>${x.email}</td><td>${x.rating}</td><td>${x.comments}</td></tr>`;
            });
            html += "</table></div>";
        });

        document.getElementById("myForms").innerHTML = html;
    }

    // ----------- Open Form (User) -----------
    let currentForm = null;
    function openForm() {
        let formCode = document.getElementById("formCodeInput").value;
        let forms = JSON.parse(localStorage.getItem("forms"));
        let form = forms.find(f => f.code === formCode);

        if (!form) {
            alert("Invalid form code!");
            return;
        }

        currentForm = form;
        document.getElementById("formTitle").innerText = form.title + " (Code: " + form.code + ")";
        document.getElementById("feedbackForm").style.display = "block";
    }

    // ----------- Save Feedback (User) -----------
    function saveFeedback() {
        let name = document.getElementById("name").value;
        let email = document.getElementById("email").value;
        let rating = document.getElementById("rating").value;
        let comments = document.getElementById("comments").value;

        let feedbacks = JSON.parse(localStorage.getItem("feedbacks"));
        feedbacks.push({ admin: currentForm.admin, formCode: currentForm.code, name, email, rating, comments });
        localStorage.setItem("feedbacks", JSON.stringify(feedbacks));

        alert("Feedback submitted!");
        document.getElementById("name").value = "";
        document.getElementById("email").value = "";
        document.getElementById("rating").value = "";
        document.getElementById("comments").value = "";
	// Star Rating System
document.addEventListener("DOMContentLoaded", () => {
    let stars = document.querySelectorAll(".star");
    stars.forEach(star => {
        star.addEventListener("mouseover", function () {
            resetStars();
            highlightStars(this.dataset.value);
        });
        star.addEventListener("mouseout", resetStars);
        star.addEventListener("click", function () {
            document.getElementById("rating").value = this.dataset.value;
            lockStars(this.dataset.value);
        });
    });

    function highlightStars(rating) {
        let stars = document.querySelectorAll(".star");
        stars.forEach(s => {
            if (s.dataset.value <= rating) {
                s.classList.add("hovered");
            }
        });
    }
    function resetStars() {
        document.querySelectorAll(".star").forEach(s => s.classList.remove("hovered"));
    }
    function lockStars(rating) {
        document.querySelectorAll(".star").forEach(s => {
            s.classList.remove("selected");
            if (s.dataset.value <= rating) {
                s.classList.add("selected");
            }
        });
    }
});

	
    }
</script>

</body>
</html>
